<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>QwerSe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="QwerSe-一击致命，一点就透">
<meta name="keywords" content="Markdown,linux,网络,构架">
<meta property="og:type" content="website">
<meta property="og:title" content="QwerSe">
<meta property="og:url" content="https://www.qwerse.com/page/4/index.html">
<meta property="og:site_name" content="QwerSe">
<meta property="og:description" content="QwerSe-一击致命，一点就透">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="QwerSe">
<meta name="twitter:description" content="QwerSe-一击致命，一点就透">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">QwerSe</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个方向，来回走动</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.qwerse.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-blog/安全/勒索软件攻击防范" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/13/blog/安全/勒索软件攻击防范/" class="article-date">
  <time datetime="2017-05-12T16:00:00.000Z" itemprop="datePublished">2017-05-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/安全/">安全</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/13/blog/安全/勒索软件攻击防范/">勒索软件攻击防范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2017年5月12日起，在国内外网络中发现爆发基于Windows网络共享协议<br>进行攻击传播的蠕虫恶意代码，这是不法分子通过改造之前泄露的NSA黑客武<br>器库中“永恒之蓝”攻击程序发起的网络攻击事件。<br>目前发现的蠕虫会扫描开放445文件共享端口的Windows机器，无需用户任<br>何操作，只要开机上网，不法分子就能在电脑和服务器中植入执行勒索程序、远<br>程控制木马、虚拟货币挖矿机等恶意程序。<br>此蠕虫目前在没有对445端口进行严格访问控制的教育网及企业内网大量传<br>播，呈现爆发的态势，受感染系统会被勒索高额金钱，不能按时支付赎金的系统<br>会被销毁数据造成严重损失。该蠕虫攻击事件已经造成非常严重的现实危害，各<br>类规模的企业内网也已经面临此类威胁。<br>360安全监测与响应中心也将持续关注该事件的进展，并第一时间为您更新<br>该事件信息。<br>前情提要：北京时间2017年4月14日晚，一大批新的NSA相关网络攻击工<br>具及文档被Shadow        Brokers组织公布，其中包含了涉及多个Windows系统服务<br>（SMB、RDP、IIS）的远程命令执行工具。</p>
<hr>
<h2 id="预防感染办法"><a href="#预防感染办法" class="headerlink" title="预防感染办法:"></a>预防感染办法:</h2><pre><code>①控制面板-&gt;系统与安全-&gt;启用Windows防火墙-&gt;点击”高级设置”-&gt;点击“入站规则”-&gt;选择”新建规则”-&gt;规则类型选择“端口”-&gt;应用于“TCP”协议 特定本地端口并输入“445”-&gt;“操作”选择“阻止连接”-&gt;“配置文件”中“规则应用”全部勾选-&gt;规则名称任意输入并点击完成

②打上最新官方补丁https://technet.microsoft.com/zh-cn/library/security/MS17-010

（各系统具体补丁：win7 : https://mirror.sdu.edu.cn/ms17-010/win7/  

win8 : https://mirror.sdu.edu.cn/ms17-010/win8/

win10 : https://mirror.sdu.edu.cn/ms17-010/win10/）


③XP win2003 以下  https://dl.360safe.com/nsa/nsatool.exe  （360的检测与修复工具）

④个人蔫脑最直接的办法就是用杀软快速扫描一下，基本上能够检测出开了哪些风险端口并处理关闭
</code></pre><p>提示：官方补丁完成后，可以下载文章内那个360的检测以下 是不是修复完成。</p>
<p>另外附加一个H大发布的已经被感染电脑的解决办法：<br>1:打开那个勒索软件界面，点击copy. （复制黑客的比特币地址）<br>2:把copy粘贴到btc.com （区块链查询器）<br>3:在区块链查询器中找到黑客收款地址的交易记录，然后随意选择一个txid（交易哈希值）<br>4:把txid 复制粘贴给 勒索软件界面按钮connect us.<br>5:等黑客看到后 你再点击勒索软件上的check payment.<br>6:再点击decrypt 解密文件即可。<br>此方法不知道有没有用，想看看的人可以找个样本在虚拟机里面尝试一下（附上样本文件哈勃分析结果报告：<a href="https://habo.qq.com/file/showdetail?pk=ADEGY11uB2IIPVs5）" target="_blank" rel="noopener">https://habo.qq.com/file/showdetail?pk=ADEGY11uB2IIPVs5）</a></p>
<p>再附上一个最新解决已感染文件找回办法：<br>到卡巴斯基下载文件解锁工具<a href="https://ransom.kaspersky.com/（据说是攻破了黑客的密钥库，利用已有密钥研究出了反向破解的黑科技），有一定概率能够恢复文件" target="_blank" rel="noopener">https://ransom.kaspersky.com/（据说是攻破了黑客的密钥库，利用已有密钥研究出了反向破解的黑科技），有一定概率能够恢复文件</a><br>（此方法来自网络具体结果可以自己在已经感染的电脑上尝试恢复）</p>
<p>大部分内容来自吾爱论坛</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2017/05/13/blog/安全/勒索软件攻击防范/" data-id="cjm39c2u5002ijkucxl0s3m56" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2017/05/13/blog/安全/勒索软件攻击防范/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/">安全</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/linux/fedora安装和必备软件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/03/blog/linux/fedora安装和必备软件/" class="article-date">
  <time datetime="2017-01-02T16:00:00.000Z" itemprop="datePublished">2017-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/03/blog/linux/fedora安装和必备软件/">fedora安装和必备软件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>学习linux一直用的是centos，用其他的linux版本很不熟悉，一开始用的是manjaro，pacman管理不是很熟悉<br>之后用了deepin，没想到安装一半出错了，我都不知道是怎么回事，把错误反馈了社区，之后决定使用fedora，更centos差不多<br>我就用着了，不换了。<br>　　当然，刚开始有很多东西需要配置，才能更好的使用。</p>
<h3 id="1必须要配置好软件源，才能方便行事"><a href="#1必须要配置好软件源，才能方便行事" class="headerlink" title="1必须要配置好软件源，才能方便行事"></a>1必须要配置好软件源，才能方便行事</h3><pre><code>#### 这是个网页，创建一个repo，把网页里面的内容复制进去
    https://github.com/FZUG/repo/blob/master/repos/FZUG.repo
#### 这个是个可以安装上面源没有的软件
    rpm -ivh http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm
</code></pre><p>###　2开始安装常用软件</p>
<h4 id="看清楚name的行，sudo-dnf-install-name-就能安装你想要安装的软件了"><a href="#看清楚name的行，sudo-dnf-install-name-就能安装你想要安装的软件了" class="headerlink" title="看清楚name的行，sudo dnf install $name　就能安装你想要安装的软件了"></a>看清楚name的行，sudo dnf install $name　就能安装你想要安装的软件了</h4><p>#####　在安装软件时可能会少依赖，慢慢补就行了。     </p>
<h2 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sogoupinyin 	 	搜狗拼音输入法</span><br><span class="line">fcitx-rime 		中州韵输入法</span><br><span class="line">fcitx-sunpinyin 	sunpinyin 输入法</span><br><span class="line">fcitx-qt5 		fcitx qt5 输入模块</span><br><span class="line">Multimedia</span><br><span class="line">kwplayer 	 	酷我音乐</span><br><span class="line">doubanfm-qt 	 	豆瓣FM</span><br><span class="line">musicbox 	 	网易云音乐 CLI</span><br><span class="line">deepin-music-player 	 	深度音乐</span><br><span class="line">moonplayer 		Moonplayer播放器</span><br><span class="line">simplescreenrecorder 	 	屏幕录像</span><br><span class="line">obs-studio 	 	屏幕录像/流媒体直播</span><br><span class="line">tragtor 	 	FFmpeg音视频转码</span><br><span class="line">Notes / Dict</span><br><span class="line">wiznote 		为知笔记 stable</span><br><span class="line">wiznote-beta 	 	为知笔记 beta</span><br><span class="line">youdao-dict 	 	有道词典 <span class="keyword">for</span> linux</span><br><span class="line">Browser / Proxy</span><br><span class="line">opera-developer  	Opera developer</span><br><span class="line">opera-beta 	 	Opera beta</span><br><span class="line">opera-stable 	 	Opera stable</span><br><span class="line">freshplayerplugin 	Firefox PPAPI flash 兼容插件</span><br><span class="line">Downloads</span><br><span class="line">bcloud 	　　　　　 	百度云客户端</span><br><span class="line">xware-desktop 	 	迅雷客户端</span><br><span class="line">pointdownload 		点载, 支持迅雷/BT/ed2k下载</span><br><span class="line">System tools</span><br><span class="line">ccal 	　　　　　	命令行下的农历日历</span><br><span class="line">grub4dos 		grub 引导管理器</span><br><span class="line">screenfetch 		系统信息收集</span><br><span class="line">vim 7.4.764 		编辑器之神，增加剪贴板/lua/py3支持</span><br><span class="line">dkms-mt7601u 		MT7601U USB Wifi 驱动</span><br><span class="line">System libraries</span><br><span class="line">opencc 		 	简繁转换库，修正依赖</span><br><span class="line">sunpinyin 	 	基于 SLM 模型的输入法引擎，更新字典</span><br><span class="line">python-html2text 	fedora 	HTML -&gt; ASCII</span><br><span class="line">python3-xlib 		Python3 X 库</span><br><span class="line">python3-keybinder 	<span class="literal">null</span> 	Python3 键绑定库</span><br><span class="line">python-mutagen 		处理音频元数据</span><br><span class="line">python3-cairo 		Python3 cairo 绑定，修复 bug</span><br><span class="line">pygobject3 		Python GObject 封装，修复 bug</span><br><span class="line">deepin-ui 		Deepin UI toolkit</span><br><span class="line">deepin-utils 		Deepin utils 库</span><br><span class="line">deepin-gsettings 	gsettings python 绑定</span><br><span class="line">pyjavascriptcore 	fedora 	pyjs</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2017/01/03/blog/linux/fedora安装和必备软件/" data-id="cjm39c2td0016jkucijd5ent9" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2017/01/03/blog/linux/fedora安装和必备软件/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/linux/docker的基本用法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/08/blog/linux/docker的基本用法/" class="article-date">
  <time datetime="2016-12-07T16:00:00.000Z" itemprop="datePublished">2016-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/08/blog/linux/docker的基本用法/">docker的基本用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>就如同mysql改查一样只需要了解就行，以后需要在深入，就行了。</p>
<p>构建镜像</p>
<pre><code>docker search nginx \\以nginx的docker镜像为例
docker pull   nginx \\获取镜像
docker images       \\查看本机有哪些docker镜像
</code></pre><p>在亲自获取过程中由于国情，被 q 了，只有到国内去下载了</p>
<pre><code>1，阿里云docker加速器
2，时速云docker市场
</code></pre><p>都能获取到镜像。</p>
<h4 id="1，从一个镜像，启动一个容器"><a href="#1，从一个镜像，启动一个容器" class="headerlink" title="1，从一个镜像，启动一个容器"></a>1，从一个镜像，启动一个容器</h4><pre><code>docker run -it --name one-nginx nginx /bin/bash
\\run 运行的意思，-it 开启一个伪终端，不关闭，--name 起一个自定义名字,/bin/bash 启动的程序
    docker run -idt --name one-nginx nginx /bin/bash
    \\-d 把程序后端运行
</code></pre><h4 id="2，查看容器运行情况"><a href="#2，查看容器运行情况" class="headerlink" title="2，查看容器运行情况"></a>2，查看容器运行情况</h4><pre><code>docker ps  \\查看进程
docker ps -a \\查看所有进程
docker ps -l \\查看最后一个进程
</code></pre><h4 id="3，删除容器"><a href="#3，删除容器" class="headerlink" title="3，删除容器"></a>3，删除容器</h4><pre><code>docker rm 容器id
</code></pre><h4 id="4，删除镜像"><a href="#4，删除镜像" class="headerlink" title="4，删除镜像"></a>4，删除镜像</h4><pre><code>docker rmi 镜像id
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/12/08/blog/linux/docker的基本用法/" data-id="cjm39c2tc0013jkucsifgdji8" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/12/08/blog/linux/docker的基本用法/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/linux/centos6,内核升级为3.10" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/03/blog/linux/centos6,内核升级为3.10/" class="article-date">
  <time datetime="2016-11-02T16:00:00.000Z" itemprop="datePublished">2016-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/blog/linux/centos6,内核升级为3.10/">centos6,内核升级为3.10</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="导入公钥："><a href="#导入公钥：" class="headerlink" title="导入公钥："></a>导入公钥：</h3><pre><code>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</code></pre><h3 id="要为redhat6和centos6安装ELRepo6仓库："><a href="#要为redhat6和centos6安装ELRepo6仓库：" class="headerlink" title="要为redhat6和centos6安装ELRepo6仓库："></a>要为redhat6和centos6安装ELRepo6仓库：</h3><pre><code>rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm
</code></pre><h3 id="安装-kernel-lt（lt-long-term）"><a href="#安装-kernel-lt（lt-long-term）" class="headerlink" title="安装 kernel-lt（lt=long-term）"></a>安装 kernel-lt（lt=long-term）</h3><pre><code>yum --enablerepo=elrepo-kernel install kernel-lt -y
</code></pre><h3 id="编辑grub-conf文件，修改Grub引导顺序"><a href="#编辑grub-conf文件，修改Grub引导顺序" class="headerlink" title="编辑grub.conf文件，修改Grub引导顺序"></a>编辑grub.conf文件，修改Grub引导顺序</h3><pre><code>vim /etc/grub.conf
# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You do not have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /, eg.
#          root (hd0,0)
#          kernel /boot/vmlinuz-version ro root=/dev/sda1
#          initrd /boot/initrd-[generic-]version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
hiddenmenu
title CentOS (3.10.28-1.el6.elrepo.x86_64)
        root (hd0,0)
        kernel /boot/vmlinuz-3.10.28-1.el6.elrepo.x86_64 ro root=UUID=0a05411f-16f2-4d69-beb0-2db4cefd3613 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_MD crashkernel=auto LANG=en_US.UTF-8
 rd_NO_LVM rd_NO_DM rhgb quiet
        initrd /boot/initramfs-3.10.28-1.el6.elrepo.x86_64.img
title CentOS (2.6.32-431.3.1.el6.x86_64)
        root (hd0,0)
        kernel /boot/vmlinuz-2.6.32-431.3.1.el6.x86_64 ro root=UUID=0a05411f-16f2-4d69-beb0-2db4cefd3613 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_MD crashkernel=auto LANG=en_US.UTF-8 r
d_NO_LVM rd_NO_DM rhgb quiet
        initrd /boot/initramfs-2.6.32-431.3.1.el6.x86_64.img
title CentOS (2.6.32-431.el6.x86_64)
        root (hd0,0)
        kernel /boot/vmlinuz-2.6.32-431.el6.x86_64 ro root=UUID=0a05411f-16f2-4d69-beb0-2db4cefd3613 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_MD crashkernel=auto LANG=zh_CN.UTF-8 rd_NO
_LVM rd_NO_DM rhgb quiet
        initrd /boot/initramfs-2.6.32-431.el6.x86_64.img
确认刚安装好的内核在哪个位置，然后设置default值（从0开始），一般新安装的内核在第一个位置，所以设置default=0。
</code></pre><h3 id="5、重启，查看内核版本号"><a href="#5、重启，查看内核版本号" class="headerlink" title="5、重启，查看内核版本号"></a>5、重启，查看内核版本号</h3><pre><code>[root@dev ~]# uname -r
3.10.28-1.el6.elrepo.x86_64
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/11/03/blog/linux/centos6,内核升级为3.10/" data-id="cjm39c2sx000ejkucdypqsgtz" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/11/03/blog/linux/centos6,内核升级为3.10/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/web/http 状态代码表" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/03/blog/web/http 状态代码表/" class="article-date">
  <time datetime="2016-10-02T16:00:00.000Z" itemprop="datePublished">2016-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/网络/">网络</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/03/blog/web/http 状态代码表/">http 状态代码表</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>　  </p>
<h4 id="2xx-成功"><a href="#2xx-成功" class="headerlink" title="2xx  成功"></a>2xx  成功</h4><p>200  正常；请求已完成。<br>201  正常；紧接 POST 命令。<br>202  正常；已接受用于处理，但处理尚未完成。<br>203  正常；部分信息 — 返回的信息只是一部分。<br>204  正常；无响应 — 已接收请求，但不存在要回送的信息。  </p>
<h4 id="3xx-重定向"><a href="#3xx-重定向" class="headerlink" title="3xx  重定向"></a>3xx  重定向</h4><p>301  已移动 — 请求的数据具有新的位置且更改是永久的。<br>302  已找到 — 请求的数据临时具有不同 URI。<br>303  请参阅其它 — 可在另一 URI 下找到对请求的响应，且应使用 GET 方法检索此响应。<br>304  未修改 — 未按预期修改文档。<br>305  使用代理 — 必须通过位置字段中提供的代理来访问请求的资源。<br>306  未使用 — 不再使用；保留此代码以便将来使用。  </p>
<h4 id="4xx-客户机中出现的错误"><a href="#4xx-客户机中出现的错误" class="headerlink" title="4xx  客户机中出现的错误"></a>4xx  客户机中出现的错误</h4><p>400  错误请求 — 请求中有语法问题，或不能满足请求。<br>401  未授权 — 未授权客户机访问数据。<br>402  需要付款 — 表示计费系统已有效。<br>403  禁止 — 即使有授权也不需要访问。<br>404  找不到 — 服务器找不到给定的资源；文档不存在。<br>407  代理认证请求 — 客户机首先必须使用代理认证自身。<br>415  介质类型不受支持 — 服务器拒绝服务请求，因为不支持请求实体的格式。  </p>
<h4 id="5xx-服务器中出现的错误"><a href="#5xx-服务器中出现的错误" class="headerlink" title="5xx  服务器中出现的错误"></a>5xx  服务器中出现的错误</h4><p>500  内部错误 — 因为意外情况，服务器不能完成请求。<br>501  未执行 — 服务器不支持请求的工具。<br>502  错误网关 — 服务器接收到来自上游服务器的无效响应。<br>503  无法获得服务 — 由于临时过载或维护，服务器无法处理请求。</p>
<p>HTTP 400 - 请求无效 </p>
<p>HTTP 401.1 - 未授权：登录失败 </p>
<p>HTTP 401.2 - 未授权：服务器配置问题导致登录失败 </p>
<p>HTTP 401.3 - ACL 禁止访问资源 </p>
<p>HTTP 401.4 - 未授权：授权被筛选器拒绝 </p>
<p>HTTP 401.5 - 未授权：ISAPI 或 CGI 授权失败  </p>
<p>HTTP 403 - 禁止访问 </p>
<p>HTTP 403 - 对 Internet 服务管理器 (HTML) 的访问仅限于 Localhost </p>
<p>HTTP 403.1 禁止访问：禁止可执行访问 </p>
<p>HTTP 403.2 - 禁止访问：禁止读访问 </p>
<p>HTTP 403.3 - 禁止访问：禁止写访问 </p>
<p>HTTP 403.4 - 禁止访问：要求 SSL </p>
<p>HTTP 403.5 - 禁止访问：要求 SSL 128 </p>
<p>HTTP 403.6 - 禁止访问：IP 地址被拒绝 </p>
<p>HTTP 403.7 - 禁止访问：要求客户证书 </p>
<p>HTTP 403.8 - 禁止访问：禁止站点访问 </p>
<p>HTTP 403.9 - 禁止访问：连接的用户过多 </p>
<p>HTTP 403.10 - 禁止访问：配置无效 </p>
<p>HTTP 403.11 - 禁止访问：密码更改 </p>
<p>HTTP 403.12 - 禁止访问：映射器拒绝访问 </p>
<p>HTTP 403.13 - 禁止访问：客户证书已被吊销 </p>
<p>HTTP 403.15 - 禁止访问：客户访问许可过多 </p>
<p>HTTP 403.16 - 禁止访问：客户证书不可信或者无效 </p>
<p>HTTP 403.17 - 禁止访问：客户证书已经到期或者尚未生效 </p>
<p>HTTP 404.1 - 无法找到 Web 站点 </p>
<p>HTTP 404 - 无法找到文件 </p>
<p>HTTP 405 - 资源被禁止 </p>
<p>HTTP 406 - 无法接受 </p>
<p>HTTP 407 - 要求代理身份验证 </p>
<p>HTTP 410 - 永远不可用 </p>
<p>HTTP 412 - 先决条件失败 </p>
<p>HTTP 414 - 请求 - URI 太长 </p>
<p>HTTP 500 - 内部服务器错误 </p>
<p>HTTP 500.100 - 内部服务器错误 - ASP 错误 </p>
<p>HTTP 500-11 服务器关闭 </p>
<p>HTTP 500-12 应用程序重新启动 </p>
<p>HTTP 500-13 - 服务器太忙 </p>
<p>HTTP 500-14 - 应用程序无效 </p>
<p>HTTP 500-15 - 不允许请求 global.asa </p>
<p>Error 501 - 未实现 </p>
<p>HTTP 502 - 网关错误 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/10/03/blog/web/http 状态代码表/" data-id="cjm39c2u2002cjkuc43xvrpwo" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/10/03/blog/web/http 状态代码表/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/mysql/MySql主从备份" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/29/blog/mysql/MySql主从备份/" class="article-date">
  <time datetime="2016-09-28T16:00:00.000Z" itemprop="datePublished">2016-09-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/29/blog/mysql/MySql主从备份/">MySql主从备份</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一-MySQL复制概述"><a href="#一-MySQL复制概述" class="headerlink" title="一.MySQL复制概述"></a>一.MySQL复制概述</h3><p>MySQL支持单向、异步复制，复制过程中一个服务器充当主服务器，而一个或多个其它服务器充当从服务器。MySQL复制基于主服务器在二进制日志中跟踪所有对数据库的更改(更新、删除等等)。因此，要进行复制，必须在主服务器上启用二进制日志。每个从服务器从主服务器接收主服务器已经记录到其二进制日志的保存的更新。当一个从服务器连接主服务器时，它通知主服务器从服务器在日志中读取的最后一次成功更新的位置。从服务器接收从那时起发生的任何更新，并在本机上执行相同的更新。然后封锁并等待主服务器通知新的更新。从服务器执行备份不会干扰主服务器，在备份过程中主服务器可以继续处理更新。</p>
<h3 id="二-复制实现细节"><a href="#二-复制实现细节" class="headerlink" title="二.复制实现细节"></a>二.复制实现细节</h3><p>   MySQL使用3个线程来执行复制功能(其中1个在主服务器上，另两个在从服务器上）。当发出START SLAVE时，从服务器创建一个I/O线程，以连接主服务器并让它发送记录在其二进制日志中的语句。主服务器创建一个线程将二进制日志中的内容发送到从服务器。该线程可以即为主服务器上SHOW PROCESSLIST的输出中的Binlog Dump线程。从服务器I/O线程读取主服务器Binlog Dump线程发送的内容并将该数据拷贝到从服务器数据目录中的本地文件中，即中继日志。第3个线程是SQL线程，由从服务器创建，用于读取中继日志并执行日志中包含的更新。在从服务器上，读取和执行更新语句被分成两个独立的任务。当从服务器启动时，其I/O线程可以很快地从主服务器索取所有二进制日志内容，即使SQL线程执行更新的远远滞后。</p>
<p>####1.复制线程状态<br>通过show slave status/G和show master status可以查看复制线程状态。常见的线程状态有：</p>
<p>#####（1）主服务器Binlog Dump线程<br>·<br>        Has sent all binlog to slave; waiting for binlog to be updated<br>线程已经从二进制日志读取所有主要的更新并已经发送到了从服务器。线程现在正空闲，等待由主服务器上新的更新导致的出现在二进制日志中的新事件。</p>
<p>#####（2）从服务器I/O线程状态<br>·         Waiting for master to send event<br>线程已经连接上主服务器，正等待二进制日志事件到达。如果主服务器正空闲，会持续较长的时间。如果等待持续slave_read_timeout秒，则发生超时。此时，线程认为连接被中断并企图重新连接。</p>
<p>#####（3）从服务器SQL线程状态<br>·         Reading event from the relay log<br>线程已经从中继日志读取一个事件，可以对事件进行处理了。<br>·         Has read all relay log; waiting for the slave I/O thread to update it<br>线程已经处理了中继日志文件中的所有事件，现在正等待I/O线程将新事件写入中继日志。</p>
<h4 id="2-复制过程中使用的传递和状态文件"><a href="#2-复制过程中使用的传递和状态文件" class="headerlink" title="2.复制过程中使用的传递和状态文件"></a>2.复制过程中使用的传递和状态文件</h4><p>默认情况，中继日志使用host_name-relay-bin.nnnnnn形式的文件名，其中host_name是从服务器主机名，nnnnnn是序列号。中继日志与二进制日志的格式相同，并且可以用mysqlbinlog读取。<br>从服务器在data目录中另外创建两个小文件。这些状态文件默认名为主master.info和relay-log.info。状态文件保存在硬盘上，从服务器关闭时不会丢失。下次从服务器启动时，读取这些文件以确定它已经从主服务器读取了多少二进制日志，以及处理自己的中继日志的程度。</p>
<p>如果要备份从服务器的数据，还应备份这两个小文件以及中继日志文件。它们用来在恢复从服务器的数据后继续进行复制。如果丢失了中继日志但仍然有relay-log.info文件，可以通过检查该文件来确定SQL线程已经执行的主服务器中二进制日志的程度。然后可以用Master_Log_File和Master_LOG_POS选项执行CHANGE MASTER TO来告诉从服务器重新从该点读取二进制日志。</p>
<h3 id="三-mysql建立主从服务器配置方法"><a href="#三-mysql建立主从服务器配置方法" class="headerlink" title="三.mysql建立主从服务器配置方法"></a>三.mysql建立主从服务器配置方法</h3><p>####1.确保主从服务器的版本兼容。从服务器至少与主服务器版本相同或更高。</p>
<h4 id="2-确保主服务器上my-cnf文件的-mysqld-部分包括一个log-bin选项。该部分还应有一个server-id-Master-id选项，其中master-id必须为1到232–1之间的一个正整数值。如："><a href="#2-确保主服务器上my-cnf文件的-mysqld-部分包括一个log-bin选项。该部分还应有一个server-id-Master-id选项，其中master-id必须为1到232–1之间的一个正整数值。如：" class="headerlink" title="2.确保主服务器上my.cnf文件的[mysqld]部分包括一个log-bin选项。该部分还应有一个server-id=Master_id选项，其中master_id必须为1到232–1之间的一个正整数值。如："></a>2.确保主服务器上my.cnf文件的[mysqld]部分包括一个log-bin选项。该部分还应有一个server-id=Master_id选项，其中master_id必须为1到232–1之间的一个正整数值。如：</h4><pre><code>[mysqld]
log-bin=mysql-bin
server-id=1
</code></pre><p>####3.启动主服务器<br>注意：主服务器需要指定对哪些数据库记录二进制日志，这通过在启动主服务器时，加上<br>–binlog-do-db= db_name选项来实现。如果要记录多个数据库，要分别为每个数据库指定该选项。目前主服务器上的启动脚本请使用/data/mysql/bin/startmysql。另外，主机开机后自动启动mysqld的脚本也已经修改。</p>
<h4 id="4-在主服务器上为从服务器建立一个连接帐户，该帐户必须授予REPLICAITON-SLAVE权限。"><a href="#4-在主服务器上为从服务器建立一个连接帐户，该帐户必须授予REPLICAITON-SLAVE权限。" class="headerlink" title="4.在主服务器上为从服务器建立一个连接帐户，该帐户必须授予REPLICAITON SLAVE权限。"></a>4.在主服务器上为从服务器建立一个连接帐户，该帐户必须授予REPLICAITON SLAVE权限。</h4><pre><code>mysql&gt; GRANT REPLICATION SLAVE ON *.*
-&gt; TO &apos;帐号&apos;@&apos;从服务器IP&apos; IDENTIFIED BY &apos;密码&apos;;
</code></pre><h4 id="5-备份数据库。"><a href="#5-备份数据库。" class="headerlink" title="5.备份数据库。"></a>5.备份数据库。</h4><pre><code>shell&gt; mysqldump --master-data  --opt database_name &gt; backup-file.sql
</code></pre><h4 id="6-查看主服务器的状态"><a href="#6-查看主服务器的状态" class="headerlink" title="6.查看主服务器的状态"></a>6.查看主服务器的状态</h4><pre><code>mysql&gt; show master status/G;
</code></pre><p>记录File 和 Position 项的值<br>注：由于没有锁定主服务器，这里记录的主服务器二进制日志position值可能会大于做mysqldump时的值，这将导致从服务器丢失在此期间的更新。如果可以保证在此期间主服务器不会出现创建新表的更新，那么丢失的影响不大；否则，将导致从服务器复制线程失败，这时必须在做mysqldump时锁定主服务器。</p>
<h4 id="7-在从服务器的my-cnf文件中添加下面的行："><a href="#7-在从服务器的my-cnf文件中添加下面的行：" class="headerlink" title="7.在从服务器的my.cnf文件中添加下面的行："></a>7.在从服务器的my.cnf文件中添加下面的行：</h4><pre><code>[mysqld]
server-id=slave_id
</code></pre><p>slave_id值必须为2到232–1之间的一个正整数值。ID值唯一的标识了复制群集中的主从服务器，因此它们必须各不相同。</p>
<h4 id="8-使用–skip-slave-start选项启动从服务器启动从服务器，并导入备份数据库文件。"><a href="#8-使用–skip-slave-start选项启动从服务器启动从服务器，并导入备份数据库文件。" class="headerlink" title="8.使用–skip-slave-start选项启动从服务器启动从服务器，并导入备份数据库文件。"></a>8.使用–skip-slave-start选项启动从服务器启动从服务器，并导入备份数据库文件。</h4><pre><code>shell&gt; mysqladmin create target_db_name
shell&gt; mysql target_db_name &lt; backup-file.sql
</code></pre><p>####9.在从服务器上执行下面的语句，以系统的实际值替换选项值：<br>        mysql&gt; CHANGE MASTER TO<br>            -&gt;     MASTER_HOST=’master_host_name’,<br>            -&gt;     MASTER_USER=’replication_user_name’,<br>            -&gt;     MASTER_PASSWORD=’replication_password’,<br>            -&gt;     MASTER_LOG_FILE=’recorded_log_file_name’,<br>            -&gt;     MASTER_LOG_POS=recorded_log_position;<br>其中recorded_log_file_name和recorded_log_position分别为步骤6所记录的File和Position值。</p>
<h4 id="10-启动从服务器线程"><a href="#10-启动从服务器线程" class="headerlink" title="10.启动从服务器线程"></a>10.启动从服务器线程</h4><pre><code>mysql&gt; START SLAVE；
</code></pre><h4 id="11-执行上述程序后，从服务器应连接主服务器，并补充自从快照以来发生的任何更新。如果没有正确更新，请检查复制线程状态以及data目录下的-err文件获取信息。"><a href="#11-执行上述程序后，从服务器应连接主服务器，并补充自从快照以来发生的任何更新。如果没有正确更新，请检查复制线程状态以及data目录下的-err文件获取信息。" class="headerlink" title="11.执行上述程序后，从服务器应连接主服务器，并补充自从快照以来发生的任何更新。如果没有正确更新，请检查复制线程状态以及data目录下的.err文件获取信息。"></a>11.执行上述程序后，从服务器应连接主服务器，并补充自从快照以来发生的任何更新。如果没有正确更新，请检查复制线程状态以及data目录下的.err文件获取信息。</h4><h3 id="四-主从复制如何提高可靠性"><a href="#四-主从复制如何提高可靠性" class="headerlink" title="四.主从复制如何提高可靠性"></a>四.主从复制如何提高可靠性</h3><p>目前采用的主从单向复制，从服务器只是实时的保存了主服务器的一个副本。当主服务器发生故障时，可以切换到从服务器继续做查询，但不能更新。<br>如果采用双向复制，即两台mysql服务器即作为主服务器，又作为从服务器。那么两者都可以执行更新操作并能实现负载均衡，当一方出现故障时，另一方不受影响。但是，除非能保证任何更新操作顺序都是安全的，否则双向复制会导致失败。<br>为了更好的提高可靠性和可用性，需要当主服务器不可用时，能够在从服务器上更新，当主服务器恢复后，能够将从服务器上的更新同步到主服务器上。目前设想的方法是当主服务器不可用时，令从服务器成为Master。原来的主服务器重新启动后，设定为Slave，并从新的Master上同步更新。待同步一致后，再重新各自切换为原来的角色。具体的操作方法有待实验验证。</p>
<p>PS:主服务器产生的二进制日志会占据大量的磁盘空间，应定期删除过期的bin-log.目前通过crontab每天运行/data/mysql/data/log_auto_del.sh来删除3天前的二进制日志文件。<br>博客来自：<a href="http://blog.csdn.net/libraworm/article/details/1703365" target="_blank" rel="noopener">http://blog.csdn.net/libraworm/article/details/1703365</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/09/29/blog/mysql/MySql主从备份/" data-id="cjm39c2w1004ljkucxg8g6z13" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/09/29/blog/mysql/MySql主从备份/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/linux/mysql基础操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/25/blog/linux/mysql基础操作/" class="article-date">
  <time datetime="2016-09-24T16:00:00.000Z" itemprop="datePublished">2016-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/GitBlog/">GitBlog</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/25/blog/linux/mysql基础操作/">mysql基础操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、初识SQL语言"><a href="#一、初识SQL语言" class="headerlink" title="一、初识SQL语言"></a>一、初识SQL语言</h3><p>SQL（Structured Query Language 即结构化查询语言）<br>SQL语言主要用于存取数据、查询数据、更新数据和管理关系数据库系统，SQL语言由IBM开发。SQL语言分为3种类型：<br>DDL语句      数据库定义语言：     数据库、表、视图、索引、存储过程，例如CREATE DROP ALTER<br>DML语句      数据库操纵语言：     插入数据INSERT、删除数据DELETE、更新数据UPDATE、查询数据SELECT<br>DCL语句      数据库控制语言：     例如控制用户的访问权限GRANT、REVOKE</p>
<h3 id="二、系统数据库"><a href="#二、系统数据库" class="headerlink" title="二、系统数据库"></a>二、系统数据库</h3><pre><code>information_schema：    虚拟库，主要存储了系统中的一些数据库对象的信息，例如用户表信息、列信息、权限信息、字符信息等
performance_schema：    主要存储数据库服务器的性能参数
mysql：                        授权库，主要存储系统用户的权限信息
test：                            MySQL数据库系统自动创建的测试数据库
</code></pre><p>创建需要的业务主库…</p>
<h3 id="三、忘记MySQL密码"><a href="#三、忘记MySQL密码" class="headerlink" title="三、忘记MySQL密码"></a>三、忘记MySQL密码</h3><p> vim /etc/my.cnf                        </p>
<pre><code>[mysqld]
skip-grant-table
</code></pre><p>root#service mysqld restart<br>root#mysql</p>
<pre><code>mysql&gt; select user,password,host from mysql.user;
+------+-------------------------------------------+-----------+
| user | password                                  | host      |
+------+-------------------------------------------+-----------+
| root | *F861720E101148897B0F5239DB926E756B1C28B3 | localhost |
| root |                                           | sxl.com   |
| root |                                           | 127.0.0.1 |
| root |                                           | ::1       |
|      |                                           | localhost |
|      |                                           | sxl.com   |
+------+-------------------------------------------+-----------+
6 rows in set (0.00 sec)

mysql&gt; update mysql.user set password=password(&quot;456&quot;) where user=&quot;root&quot; and host=&quot;localhost&quot;;
mysql&gt; flush privileges;
mysql&gt; \q
</code></pre><p>root#vim /etc/my.cnf                         </p>
<pre><code>[mysqld]
#skip-grant-table
</code></pre><p>root#service mysqld restart</p>
<h4 id="创建业务数据库"><a href="#创建业务数据库" class="headerlink" title="创建业务数据库"></a>创建业务数据库</h4><p>语法</p>
<pre><code>CREATE DATABASE 数据库名;
</code></pre><h4 id="数据库命名规则："><a href="#数据库命名规则：" class="headerlink" title="数据库命名规则："></a>数据库命名规则：</h4><pre><code>区分大小写
唯一性
不能使用关键字如 create select
不能单独使用数字
</code></pre><h4 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h4><pre><code>SHOW DATABASES;
</code></pre><h4 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h4><pre><code>SELECT database();返回当前数据库的名字
USE 数据库名
</code></pre><h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><pre><code>DROP DATABASE 数据库名;
</code></pre><h4 id="创建表-字段名称-类型-值"><a href="#创建表-字段名称-类型-值" class="headerlink" title="创建表(字段名称 类型 值)"></a>创建表(字段名称 类型 值)</h4><pre><code>mysql&gt; show tables; --查看当前所有表
mysql&gt; desc emp; --查看表属性
mysql&gt;insert into emp value(1,&apos;haha&apos;,5000,&apos;oracle&apos;); --表内添加数据
mysql&gt; insert into emp values (2,&apos;up02&apos;,6000,&apos;linux&apos;);
mysql&gt; select * from emp; --查看表内数据
[root@localhost python]# mysql -uroot -puplooking
mysql&gt;  create table dept (deptno int,dname varchar(20),locate varchar(20))engine=innodb;
mysql&gt; desc dept;
+--------+-------------+------+-----+---------+-------+
| Field  | Type        | Null | Key | Default | Extra |
+--------+-------------+------+-----+---------+-------+
| deptno | int(11)     | YES  |     | NULL    |       |
| dname  | varchar(20) | YES  |     | NULL    |       |
| locate | varchar(20) | YES  |     | NULL    |       |
+--------+-------------+------+-----+---------+-------+
3 rows in set (0.00 sec)

--指定引擎，该引擎支持事务
</code></pre><h4 id="插入数据库"><a href="#插入数据库" class="headerlink" title="插入数据库"></a>插入数据库</h4><pre><code>mysql&gt; insert into dept values(1,&apos;oracle&apos;,&apos;1F&apos;) ;

mysql&gt; select * from dept;
+--------+--------+--------+
| deptno | dname  | locate |
+--------+--------+--------+
|      1 | oracle | 1F     |
+--------+--------+--------+
1 row in set (0.00 sec)


/usr/local/mysql/bin/mysqld  --verbose --help | less

Default options are read from the following files in the given order:
/etc/mysql/my.cnf /etc/my.cnf ~/.my.cnf 
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/09/25/blog/linux/mysql基础操作/" data-id="cjm39c2ta0010jkucjpo4pseu" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/09/25/blog/linux/mysql基础操作/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/linux/Rsync+inotify" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/13/blog/linux/Rsync+inotify/" class="article-date">
  <time datetime="2016-09-12T16:00:00.000Z" itemprop="datePublished">2016-09-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/13/blog/linux/Rsync+inotify/">rsync+inotify(触发式同步)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>### </p>
<h4 id="一、rsync-cron的优点与不足"><a href="#一、rsync-cron的优点与不足" class="headerlink" title="一、rsync+cron的优点与不足"></a>一、rsync+cron的优点与不足</h4><p>与传统的cp、s 需求，例如定期的备份文件服务器数据到远端服务器，对本地磁盘定期做数据镜像等。 随着应用系统规模的不断扩大，对数据的安全性和可靠性也提出的更好的要求，rsync在高端业务系统中也逐渐暴露出了很多不足，首先，rsync同步数据时，需要扫描所有文件后进行比对，进行增量传输。如果文件数量达到了百万甚至千万量级，扫描所有文件将是非常耗时的。而且正在发生变化的往往是其中很少的一部分，这是非常低效的方式。其次，rsync不能实时的去监测、同步数据，虽然它可以通过linux守护进程的方式进行触发同步，但是两次触发动作一定会有时间差，这样就导致了服务端和客户端数据可能出现不一致，无法在应用故障时完全的恢复数据</p>
<h4 id="二、inotify介绍"><a href="#二、inotify介绍" class="headerlink" title="二、inotify介绍"></a>二、inotify介绍</h4><pre><code> Inotify 是一种强大的、细粒度的、异步的文件系统事件监控机制，linux内核从2.6.13起，加入了Inotify支持，通过Inotify可以监控文件系统中添
 加、删除，修改、移动等各种细微事件，利用这个内核接口，第三方软件就可以监控文件系统下文件的各种变化情况，而inotify-tools就是这样的一
 个第三方软件。
    rsync可以实现触发式的文件同步，但是通过crontab守护进程方式进行触发，同步的数据和实际数据会有差异，而inotify可以监控文件系统的各种
变化，当文件有任何变动时，就触发rsync同步，这样刚好解决了同步数据的实时性问题。
</code></pre><h4 id="三、-安装inotify工具inotify-tools"><a href="#三、-安装inotify工具inotify-tools" class="headerlink" title="三、 安装inotify工具inotify-tools"></a>三、 安装inotify工具inotify-tools</h4><h5 id="1-确认内核支持"><a href="#1-确认内核支持" class="headerlink" title="1. 确认内核支持"></a>1. 确认内核支持</h5><pre><code>[root@uplook ~]# ll /proc/sys/fs/inotify
总计 0
-rw-r--r-- 1 root root 0 10-01 08:07 max_queued_events
-rw-r--r-- 1 root root 0 10-01 08:07 max_user_instances
-rw-r--r-- 1 root root 0 10-01 08:07 max_user_watches
</code></pre><h5 id="2-安装rsync与inotify-tools"><a href="#2-安装rsync与inotify-tools" class="headerlink" title="2 安装rsync与inotify-tools"></a>2 安装rsync与inotify-tools</h5><pre><code>http://inotify-tools.sourceforge.net
inotify-tools是用来监控文件系统变化的工具，因此必须安装在内容发布节点（数据源）
[root@uplook ~]# tar xf inotify-tools-3.14.tar.gz 
[root@uplook ~]# cd inotify-tools-3.14
[root@uplook inotify-tools-3.14]# ./configure &amp;&amp; make &amp;&amp; make install
</code></pre><p>inotify-tools指令:</p>
<p>   inotifywait        用于等待文件或文件集上的一个特定事件，它可以监控任何文件和目录<br>   inotifywatch        用于收集被监控的文件系统统计数据，包括每个inotify事件发生多少次等信息</p>
<p>####四、 inotifywait相关参数<br>Inotifywait是一个监控等待事件，可以配合shell脚本使用，常用的一些参数：</p>
<pre><code>-m， 即--monitor，表示始终保持事件监听状态
-r，      即--recursive，表示递归查询目录
-q，     即--quiet，表示打印出监控事件
-e，     即--event，通过此参数可以指定要监控的事件，常见的事件有modify、delete、create、attrib等





[root@uplook ~]# inotifywait -mrq -e modify,delete,create,attrib /var/www/html/

[root@uplook ~]# inotifywait -mrq --timefmt &apos;%d/%m/%y %H:%M&apos; --format &apos;%T %w%f&apos; -e modify,delete,create,attrib /var/www/html/
04/06/14 14:23 /var/www/html/file1
04/06/14 14:23 /var/www/html/file1

[root@uplook ~]# nohup inotifywait -mrq --timefmt &apos;%d/%m/%y %H:%M&apos; --format &apos;%T %w%f&apos; -e modify,delete,create,attrib /var/www/html &gt;&gt; file_modify.txt　&amp;

[root@uplook ~]# inotifywait -mrq --format &apos;%w%f&apos; -e modify,delete,create,attrib /var/www/html/
/var/www/html/file2
/var/www/html/file2
</code></pre><h4 id="五、配置示例"><a href="#五、配置示例" class="headerlink" title="五、配置示例"></a>五、配置示例</h4><p>拓扑图<br>                        192.168.5.11        发布服务器(数据源)<br>                        /var/www/html</p>
<pre><code>web2 192.168.5.16   web3 192.168.5.2
/var/www/html             /var/www/html
</code></pre><p>发部服务器<br> hosts</p>
<pre><code>[root@source ~]# cat /etc/hosts
127.0.0.1           localhost
192.168.5.11   source
192.168.5.16   web2
192.168.5.2     web3
</code></pre><p>配置ssh公钥认证</p>
<pre><code>[root@source ~]# ssh-keygen
[root@source ~]# ssh-copy-id -i web2
[root@source ~]# ssh-copy-id -i web3
[root@source ~]# ssh web2 date;ssh web3 date
2015年 09月 29日 星期日 11:31:19 CST
2015年 09月 29日 星期日 11:33:07 CST
</code></pre><p> 安装inotify-tools<br>[root@source ~]# yum -y install rsync httpd<br>[root@source ~]# tar xf inotify-tools-3.14.tar.gz<br>[root@source ~]# cd inotify-tools-3.14<br>[root@source inotify-tools-3.14]# ./configure &amp;&amp; make &amp;&amp; make install</p>
<p>编写脚本<br>  [root@source ~]# cat /root/rsync_inotify.sh</p>
<pre><code>#!/bin/bash                                                                                                    
web2=192.168.5.16                                                                                        
web3=192.168.5.2                                                                                        
src=/var/www/html/                                                                                        
dst=/var/www/html/                                                                                        

inotifywait -mrq  --format &apos;%w%f&apos; -e modify,delete,create,attrib $src \                
　　| while read file                                                                                        
do                                                                                                                    

                rsync -avzHXA --delete $src root@$web2:$dst &amp;&gt;/dev/null            
                rsync -avzHXA --delete $src root@$web3:$dst &amp;&gt;/dev/null            


done                                                                                                                

[root@source ~]# chmod a+x /root/rsync_inotify.sh
[root@source ~]# nohup /root/rsync_inotify.sh &amp;


web2, web3
[root@web2 ~]# yum -y install rsync httpd
[root@web3 ~]# yum -y install rsync httpd
</code></pre><p>同步测试</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.qwerse.com/2016/09/13/blog/linux/Rsync+inotify/" data-id="cjm39c2t4000ojkucptyf9eym" class="article-share-link">Share</a>
      
        <a href="https://www.qwerse.com/2016/09/13/blog/linux/Rsync+inotify/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/tags" class="mobile-nav-link">标签</a>
  
</nav>
    
<script>
  var disqus_shortname = 'QwerseBlog';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>